(function webpackUniversalModuleDefinition(root, factory) {
  if (typeof exports === 'object' && typeof module === 'object')
    module.exports = factory();
  else if (typeof define === 'function' && define.amd) define([], factory);
        else if (typeof exports === 'object') exports['deck'] = factory();
  else root['deck'] = factory();})(globalThis, function () {
"use strict";var __exports__=(()=>{var Ze=Object.create;var mr=Object.defineProperty;var qe=Object.getOwnPropertyDescriptor;var $e=Object.getOwnPropertyNames;var Ve=Object.getPrototypeOf,We=Object.prototype.hasOwnProperty;var Xe=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),Be=(r,e)=>{for(var t in e)mr(r,t,{get:e[t],enumerable:!0})},Mr=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let a of $e(e))!We.call(r,a)&&a!==t&&mr(r,a,{get:()=>e[a],enumerable:!(n=qe(e,a))||n.enumerable});return r},V=(r,e,t)=>(Mr(r,e,"default"),t&&Mr(t,e,"default")),lr=(r,e,t)=>(t=r!=null?Ze(Ve(r)):{},Mr(e||!r||!r.__esModule?mr(t,"default",{value:r,enumerable:!0}):t,r)),Ue=r=>Mr(mr({},"__esModule",{value:!0}),r);var K=Xe((ft,ie)=>{ie.exports=globalThis.deck});var dr={};Be(dr,{MapboxLayer:()=>Lr,MapboxOverlay:()=>De});var q={},oe=lr(K());V(q,lr(K()));if(!oe.Layer)throw new Error("@deck.gl/core is not found");V(dr,q);function B(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function se(r,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,n.key,n)}}function U(r,e,t){return e&&se(r.prototype,e),t&&se(r,t),r}function h(r,e,t){return e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}var X=lr(K());function J(r,e){(e==null||e>r.length)&&(e=r.length);for(var t=0,n=new Array(e);t<e;t++)n[t]=r[t];return n}function kr(r){if(Array.isArray(r))return J(r)}function Dr(r){if(typeof Symbol<"u"&&r[Symbol.iterator]!=null||r["@@iterator"]!=null)return Array.from(r)}function fr(r,e){if(r){if(typeof r=="string")return J(r,e);var t=Object.prototype.toString.call(r).slice(8,-1);if(t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set")return Array.from(r);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return J(r,e)}}function Rr(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function rr(r){return kr(r)||Dr(r)||fr(r)||Rr()}function Nr(r){if(Array.isArray(r))return r}function Fr(r,e){var t=r==null?null:typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(t!=null){var n=[],a=!0,v=!1,o,i;try{for(t=t.call(r);!(a=(o=t.next()).done)&&(n.push(o.value),!(e&&n.length===e));a=!0);}catch(s){v=!0,i=s}finally{try{!a&&t.return!=null&&t.return()}finally{if(v)throw i}}return n}}function Cr(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function j(r,e){return Nr(r)||Fr(r,e)||fr(r,e)||Cr()}var L=1e-6,$=typeof Float32Array<"u"?Float32Array:Array;var Dt=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var r=0,e=arguments.length;e--;)r+=arguments[e]*arguments[e];return Math.sqrt(r)});function He(){var r=new $(4);return $!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0,r[3]=0),r}function le(r,e,t){return r[0]=e[0]*t,r[1]=e[1]*t,r[2]=e[2]*t,r[3]=e[3]*t,r}function fe(r,e,t){var n=e[0],a=e[1],v=e[2],o=e[3];return r[0]=t[0]*n+t[4]*a+t[8]*v+t[12]*o,r[1]=t[1]*n+t[5]*a+t[9]*v+t[13]*o,r[2]=t[2]*n+t[6]*a+t[10]*v+t[14]*o,r[3]=t[3]*n+t[7]*a+t[11]*v+t[15]*o,r}var Rt=function(){var r=He();return function(e,t,n,a,v,o){var i,s;for(t||(t=4),n||(n=0),a?s=Math.min(a*t+n,e.length):s=e.length,i=n;i<s;i+=t)r[0]=e[i],r[1]=e[i+1],r[2]=e[i+2],r[3]=e[i+3],v(r,r,o),e[i]=r[0],e[i+1]=r[1],e[i+2]=r[2],e[i+3]=r[3];return e}}();function er(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function W(r,e){var t=fe([],e,r);return le(t,t,1/t[3]),t}function cr(r,e,t){return r<e?e:r>t?t:r}function Ge(r){return Math.log(r)*Math.LOG2E}var yr=Math.log2||Ge;function ce(r,e){var t=e[0],n=e[1],a=e[2],v=e[3],o=e[4],i=e[5],s=e[6],l=e[7],c=e[8],f=e[9],p=e[10],u=e[11],_=e[12],w=e[13],P=e[14],m=e[15],O=t*i-n*o,d=t*s-a*o,y=t*l-v*o,g=n*s-a*i,M=n*l-v*i,b=a*l-v*s,I=c*w-f*_,T=c*P-p*_,S=c*m-u*_,z=f*P-p*w,E=f*m-u*w,A=p*m-u*P,x=O*A-d*E+y*z+g*S-M*T+b*I;return x?(x=1/x,r[0]=(i*A-s*E+l*z)*x,r[1]=(a*E-n*A-v*z)*x,r[2]=(w*b-P*M+m*g)*x,r[3]=(p*M-f*b-u*g)*x,r[4]=(s*S-o*A-l*T)*x,r[5]=(t*A-a*S+v*T)*x,r[6]=(P*y-_*b-m*d)*x,r[7]=(c*b-p*y+u*d)*x,r[8]=(o*E-i*S+l*I)*x,r[9]=(n*S-t*E-v*I)*x,r[10]=(_*M-w*y+m*O)*x,r[11]=(f*y-c*M-u*O)*x,r[12]=(i*T-o*z-s*I)*x,r[13]=(t*z-n*T+a*I)*x,r[14]=(w*d-_*g-P*O)*x,r[15]=(c*g-f*d+p*O)*x,r):null}function ur(r,e,t){var n=e[0],a=e[1],v=e[2],o=e[3],i=e[4],s=e[5],l=e[6],c=e[7],f=e[8],p=e[9],u=e[10],_=e[11],w=e[12],P=e[13],m=e[14],O=e[15],d=t[0],y=t[1],g=t[2],M=t[3];return r[0]=d*n+y*i+g*f+M*w,r[1]=d*a+y*s+g*p+M*P,r[2]=d*v+y*l+g*u+M*m,r[3]=d*o+y*c+g*_+M*O,d=t[4],y=t[5],g=t[6],M=t[7],r[4]=d*n+y*i+g*f+M*w,r[5]=d*a+y*s+g*p+M*P,r[6]=d*v+y*l+g*u+M*m,r[7]=d*o+y*c+g*_+M*O,d=t[8],y=t[9],g=t[10],M=t[11],r[8]=d*n+y*i+g*f+M*w,r[9]=d*a+y*s+g*p+M*P,r[10]=d*v+y*l+g*u+M*m,r[11]=d*o+y*c+g*_+M*O,d=t[12],y=t[13],g=t[14],M=t[15],r[12]=d*n+y*i+g*f+M*w,r[13]=d*a+y*s+g*p+M*P,r[14]=d*v+y*l+g*u+M*m,r[15]=d*o+y*c+g*_+M*O,r}function hr(r,e,t){var n=t[0],a=t[1],v=t[2],o,i,s,l,c,f,p,u,_,w,P,m;return e===r?(r[12]=e[0]*n+e[4]*a+e[8]*v+e[12],r[13]=e[1]*n+e[5]*a+e[9]*v+e[13],r[14]=e[2]*n+e[6]*a+e[10]*v+e[14],r[15]=e[3]*n+e[7]*a+e[11]*v+e[15]):(o=e[0],i=e[1],s=e[2],l=e[3],c=e[4],f=e[5],p=e[6],u=e[7],_=e[8],w=e[9],P=e[10],m=e[11],r[0]=o,r[1]=i,r[2]=s,r[3]=l,r[4]=c,r[5]=f,r[6]=p,r[7]=u,r[8]=_,r[9]=w,r[10]=P,r[11]=m,r[12]=o*n+c*a+_*v+e[12],r[13]=i*n+f*a+w*v+e[13],r[14]=s*n+p*a+P*v+e[14],r[15]=l*n+u*a+m*v+e[15]),r}function _r(r,e,t){var n=t[0],a=t[1],v=t[2];return r[0]=e[0]*n,r[1]=e[1]*n,r[2]=e[2]*n,r[3]=e[3]*n,r[4]=e[4]*a,r[5]=e[5]*a,r[6]=e[6]*a,r[7]=e[7]*a,r[8]=e[8]*v,r[9]=e[9]*v,r[10]=e[10]*v,r[11]=e[11]*v,r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r}function he(r,e,t){var n=Math.sin(t),a=Math.cos(t),v=e[4],o=e[5],i=e[6],s=e[7],l=e[8],c=e[9],f=e[10],p=e[11];return e!==r&&(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[4]=v*a+l*n,r[5]=o*a+c*n,r[6]=i*a+f*n,r[7]=s*a+p*n,r[8]=l*a-v*n,r[9]=c*a-o*n,r[10]=f*a-i*n,r[11]=p*a-s*n,r}function pe(r,e,t){var n=Math.sin(t),a=Math.cos(t),v=e[0],o=e[1],i=e[2],s=e[3],l=e[4],c=e[5],f=e[6],p=e[7];return e!==r&&(r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=v*a+l*n,r[1]=o*a+c*n,r[2]=i*a+f*n,r[3]=s*a+p*n,r[4]=l*a-v*n,r[5]=c*a-o*n,r[6]=f*a-i*n,r[7]=p*a-s*n,r}function Qe(r,e,t,n,a){var v=1/Math.tan(e/2),o;return r[0]=v/t,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=v,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,a!=null&&a!==1/0?(o=1/(n-a),r[10]=(a+n)*o,r[14]=2*a*n*o):(r[10]=-1,r[14]=-2*n),r}var de=Qe;function Yr(r,e){var t=r[0],n=r[1],a=r[2],v=r[3],o=r[4],i=r[5],s=r[6],l=r[7],c=r[8],f=r[9],p=r[10],u=r[11],_=r[12],w=r[13],P=r[14],m=r[15],O=e[0],d=e[1],y=e[2],g=e[3],M=e[4],b=e[5],I=e[6],T=e[7],S=e[8],z=e[9],E=e[10],A=e[11],x=e[12],Z=e[13],R=e[14],k=e[15];return Math.abs(t-O)<=L*Math.max(1,Math.abs(t),Math.abs(O))&&Math.abs(n-d)<=L*Math.max(1,Math.abs(n),Math.abs(d))&&Math.abs(a-y)<=L*Math.max(1,Math.abs(a),Math.abs(y))&&Math.abs(v-g)<=L*Math.max(1,Math.abs(v),Math.abs(g))&&Math.abs(o-M)<=L*Math.max(1,Math.abs(o),Math.abs(M))&&Math.abs(i-b)<=L*Math.max(1,Math.abs(i),Math.abs(b))&&Math.abs(s-I)<=L*Math.max(1,Math.abs(s),Math.abs(I))&&Math.abs(l-T)<=L*Math.max(1,Math.abs(l),Math.abs(T))&&Math.abs(c-S)<=L*Math.max(1,Math.abs(c),Math.abs(S))&&Math.abs(f-z)<=L*Math.max(1,Math.abs(f),Math.abs(z))&&Math.abs(p-E)<=L*Math.max(1,Math.abs(p),Math.abs(E))&&Math.abs(u-A)<=L*Math.max(1,Math.abs(u),Math.abs(A))&&Math.abs(_-x)<=L*Math.max(1,Math.abs(_),Math.abs(x))&&Math.abs(w-Z)<=L*Math.max(1,Math.abs(w),Math.abs(Z))&&Math.abs(P-R)<=L*Math.max(1,Math.abs(P),Math.abs(R))&&Math.abs(m-k)<=L*Math.max(1,Math.abs(m),Math.abs(k))}function Ke(){var r=new $(2);return $!=Float32Array&&(r[0]=0,r[1]=0),r}function Zr(r,e,t){return r[0]=e[0]+t[0],r[1]=e[1]+t[1],r}function Me(r,e){return r[0]=-e[0],r[1]=-e[1],r}function wr(r,e,t,n){var a=e[0],v=e[1];return r[0]=a+n*(t[0]-a),r[1]=v+n*(t[1]-v),r}var Yt=function(){var r=Ke();return function(e,t,n,a,v,o){var i,s;for(t||(t=2),n||(n=0),a?s=Math.min(a*t+n,e.length):s=e.length,i=n;i<s;i+=t)r[0]=e[i],r[1]=e[i+1],v(r,r,o),e[i]=r[0],e[i+1]=r[1];return e}}();function Je(){var r=new $(3);return $!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r}function me(r,e,t){return r[0]=e[0]+t[0],r[1]=e[1]+t[1],r[2]=e[2]+t[2],r}function rt(r,e,t){return r[0]=e[0]*t[0],r[1]=e[1]*t[1],r[2]=e[2]*t[2],r}function ge(r,e){return r[0]=-e[0],r[1]=-e[1],r[2]=-e[2],r}var ye=rt;var Zt=function(){var r=Je();return function(e,t,n,a,v,o){var i,s;for(t||(t=3),n||(n=0),a?s=Math.min(a*t+n,e.length):s=e.length,i=n;i<s;i+=t)r[0]=e[i],r[1]=e[i+1],r[2]=e[i+2],v(r,r,o),e[i]=r[0],e[i+1]=r[1],e[i+2]=r[2];return e}}();function N(r,e){if(!r)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}var F=Math.PI,_e=F/4,C=F/180,$r=180/F,tr=512,Vr=4003e4,ar=85.051129,Wr=1.5;function Pr(r){return Math.pow(2,r)}function D(r){var e=j(r,2),t=e[0],n=e[1];N(Number.isFinite(t)),N(Number.isFinite(n)&&n>=-90&&n<=90,"invalid latitude");var a=t*C,v=n*C,o=tr*(a+F)/(2*F),i=tr*(F+Math.log(Math.tan(_e+v*.5)))/(2*F);return[o,i]}function Y(r){var e=j(r,2),t=e[0],n=e[1],a=t/tr*(2*F)-F,v=2*(Math.atan(Math.exp(n/tr*(2*F)-F))-_e);return[a*$r,v*$r]}function Xr(r){var e=Math.cos(r*C);return tr/Vr/e}function Br(r){var e=r.latitude,t=r.longitude,n=r.highPrecision,a=n===void 0?!1:n;N(Number.isFinite(e)&&Number.isFinite(t));var v=tr,o=Math.cos(e*C),i=v/360,s=i/o,l=v/Vr/o,c={unitsPerMeter:[l,l,l],metersPerUnit:[1/l,1/l,1/l],unitsPerDegree:[i,s,l],degreesPerUnit:[1/i,1/s,1/l]};if(a){var f=C*Math.tan(e*C)/o,p=i*f/2,u=v/Vr*f,_=u/s*l;c.unitsPerDegree2=[0,p,u],c.unitsPerMeter2=[_,0,_]}return c}function Ur(r){var e=r.height,t=r.pitch,n=r.bearing,a=r.altitude,v=r.scale,o=r.center,i=er();hr(i,i,[0,0,-a]),he(i,i,-t*C),pe(i,i,n*C);var s=v/e;return _r(i,i,[s,s,s]),o&&hr(i,i,ge([],o)),i}function we(r){var e=r.width,t=r.height,n=r.altitude,a=r.pitch,v=a===void 0?0:a,o=r.offset,i=r.center,s=r.scale,l=r.nearZMultiplier,c=l===void 0?1:l,f=r.farZMultiplier,p=f===void 0?1:f,u=r.fovy,_=u===void 0?nr(Wr):u;n!==void 0&&(_=nr(n));var w=_*C,P=v*C,m=Or(_),O=m;i&&(O+=i[2]*s/Math.cos(P)/t);var d=w*(.5+(o?o[1]:0)/t),y=Math.sin(d)*O/Math.sin(cr(Math.PI/2-P-d,.01,Math.PI-.01)),g=Math.sin(P)*y+O,M=O*10,b=Math.min(g*p,M);return{fov:w,aspect:e/t,focalDistance:m,near:c,far:b}}function Hr(r){var e=we(r),t=e.fov,n=e.aspect,a=e.near,v=e.far,o=de([],t,n,a,v);return o}function nr(r){return 2*Math.atan(.5/r)*$r}function Or(r){return .5/Math.tan(.5*r*C)}function Gr(r,e){var t=j(r,3),n=t[0],a=t[1],v=t[2],o=v===void 0?0:v;return N(Number.isFinite(n)&&Number.isFinite(a)&&Number.isFinite(o)),W(e,[n,a,o,1])}function Er(r,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=j(r,3),a=n[0],v=n[1],o=n[2];if(N(Number.isFinite(a)&&Number.isFinite(v),"invalid pixel coordinate"),Number.isFinite(o)){var i=W(e,[a,v,o,1]);return i}var s=W(e,[a,v,0,1]),l=W(e,[a,v,1,1]),c=s[2],f=l[2],p=c===f?0:((t||0)-c)/(f-c);return wr([],s,l,p)}function br(r){var e=r.width,t=r.height,n=r.bounds,a=r.minExtent,v=a===void 0?0:a,o=r.maxZoom,i=o===void 0?24:o,s=r.offset,l=s===void 0?[0,0]:s,c=j(n,2),f=j(c[0],2),p=f[0],u=f[1],_=j(c[1],2),w=_[0],P=_[1],m=et(r.padding),O=D([p,cr(P,-ar,ar)]),d=D([w,cr(u,-ar,ar)]),y=[Math.max(Math.abs(d[0]-O[0]),v),Math.max(Math.abs(d[1]-O[1]),v)],g=[e-m.left-m.right-Math.abs(l[0])*2,t-m.top-m.bottom-Math.abs(l[1])*2];N(g[0]>0&&g[1]>0);var M=g[0]/y[0],b=g[1]/y[1],I=(m.right-m.left)/2/M,T=(m.bottom-m.top)/2/b,S=[(d[0]+O[0])/2+I,(d[1]+O[1])/2+T],z=Y(S),E=Math.min(i,yr(Math.abs(Math.min(M,b))));return N(Number.isFinite(E)),{longitude:z[0],latitude:z[1],zoom:E}}function et(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return typeof r=="number"?{top:r,bottom:r,left:r,right:r}:(N(Number.isFinite(r.top)&&Number.isFinite(r.bottom)&&Number.isFinite(r.left)&&Number.isFinite(r.right)),r)}var Pe=Math.PI/180;function zr(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=r.width,n=r.height,a=r.unproject,v={targetZ:e},o=a([0,n],v),i=a([t,n],v),s,l,c=r.fovy?.5*r.fovy*Pe:Math.atan(.5/r.altitude),f=(90-r.pitch)*Pe;return c>f-.01?(s=Oe(r,0,e),l=Oe(r,t,e)):(s=a([0,0],v),l=a([t,0],v)),[o,i,l,s]}function Oe(r,e,t){var n=r.pixelUnprojectionMatrix,a=W(n,[e,0,1,1]),v=W(n,[e,r.height,1,1]),o=t*r.distanceScales.unitsPerMeter[2],i=(o-a[2])/(v[2]-a[2]),s=wr([],a,v,i),l=Y(s);return l.push(t),l}var Ee=function(){function r(){var e=this,t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{width:1,height:1};B(this,r),h(this,"latitude",void 0),h(this,"longitude",void 0),h(this,"zoom",void 0),h(this,"pitch",void 0),h(this,"bearing",void 0),h(this,"altitude",void 0),h(this,"fovy",void 0),h(this,"meterOffset",void 0),h(this,"center",void 0),h(this,"width",void 0),h(this,"height",void 0),h(this,"scale",void 0),h(this,"distanceScales",void 0),h(this,"viewMatrix",void 0),h(this,"projectionMatrix",void 0),h(this,"viewProjectionMatrix",void 0),h(this,"pixelProjectionMatrix",void 0),h(this,"pixelUnprojectionMatrix",void 0),h(this,"equals",function(E){return E instanceof r?E.width===e.width&&E.height===e.height&&Yr(E.projectionMatrix,e.projectionMatrix)&&Yr(E.viewMatrix,e.viewMatrix):!1}),h(this,"project",function(E){var A=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},x=A.topLeft,Z=x===void 0?!0:x,R=e.projectPosition(E),k=Gr(R,e.pixelProjectionMatrix),Q=j(k,2),xr=Q[0],sr=Q[1],vr=Z?sr:e.height-sr;return E.length===2?[xr,vr]:[xr,vr,k[2]]}),h(this,"unproject",function(E){var A=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},x=A.topLeft,Z=x===void 0?!0:x,R=A.targetZ,k=R===void 0?void 0:R,Q=j(E,3),xr=Q[0],sr=Q[1],vr=Q[2],Re=Z?sr:e.height-sr,Ne=k&&k*e.distanceScales.unitsPerMeter[2],Fe=Er([xr,Re,vr],e.pixelUnprojectionMatrix,Ne),Ce=e.unprojectPosition(Fe),Sr=j(Ce,3),jr=Sr[0],Ir=Sr[1],Ye=Sr[2];return Number.isFinite(vr)?[jr,Ir,Ye]:Number.isFinite(k)?[jr,Ir,k]:[jr,Ir]}),h(this,"projectPosition",function(E){var A=D(E),x=j(A,2),Z=x[0],R=x[1],k=(E[2]||0)*e.distanceScales.unitsPerMeter[2];return[Z,R,k]}),h(this,"unprojectPosition",function(E){var A=Y(E),x=j(A,2),Z=x[0],R=x[1],k=(E[2]||0)*e.distanceScales.metersPerUnit[2];return[Z,R,k]});var n=t.width,a=t.height,v=t.altitude,o=v===void 0?null:v,i=t.fovy,s=i===void 0?null:i,l=t.latitude,c=l===void 0?0:l,f=t.longitude,p=f===void 0?0:f,u=t.zoom,_=u===void 0?0:u,w=t.pitch,P=w===void 0?0:w,m=t.bearing,O=m===void 0?0:m,d=t.position,y=d===void 0?null:d,g=t.nearZMultiplier,M=g===void 0?.02:g,b=t.farZMultiplier,I=b===void 0?1.01:b;n=n||1,a=a||1,s===null&&o===null?(o=Wr,s=nr(o)):s===null?s=nr(o):o===null&&(o=Or(s));var T=Pr(_);o=Math.max(.75,o);var S=Br({longitude:p,latitude:c}),z=D([p,c]);z.push(0),y&&me(z,z,ye([],y,S.unitsPerMeter)),this.projectionMatrix=Hr({width:n,height:a,scale:T,center:z,pitch:P,fovy:s,nearZMultiplier:M,farZMultiplier:I}),this.viewMatrix=Ur({height:a,scale:T,center:z,pitch:P,bearing:O,altitude:o}),this.width=n,this.height=a,this.scale=T,this.latitude=c,this.longitude=p,this.zoom=_,this.pitch=P,this.bearing=O,this.altitude=o,this.fovy=s,this.center=z,this.meterOffset=y||[0,0,0],this.distanceScales=S,this._initMatrices(),Object.freeze(this)}return U(r,[{key:"_initMatrices",value:function(){var t=this.width,n=this.height,a=this.projectionMatrix,v=this.viewMatrix,o=er();ur(o,o,a),ur(o,o,v),this.viewProjectionMatrix=o;var i=er();_r(i,i,[t/2,-n/2,1]),hr(i,i,[1,-1,0]),ur(i,i,o);var s=ce(er(),i);if(!s)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=i,this.pixelUnprojectionMatrix=s}},{key:"projectFlat",value:function(t){return D(t)}},{key:"unprojectFlat",value:function(t){return Y(t)}},{key:"getMapCenterByLngLatPosition",value:function(t){var n=t.lngLat,a=t.pos,v=Er(a,this.pixelUnprojectionMatrix),o=D(n),i=Zr([],o,Me([],v)),s=Zr([],this.center,i);return Y(s)}},{key:"fitBounds",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=this.width,v=this.height,o=br(Object.assign({width:a,height:v,bounds:t},n)),i=o.longitude,s=o.latitude,l=o.zoom;return new r({width:a,height:v,longitude:i,latitude:s,zoom:l})}},{key:"getBounds",value:function(t){var n=this.getBoundingRegion(t),a=Math.min.apply(Math,rr(n.map(function(s){return s[0]}))),v=Math.max.apply(Math,rr(n.map(function(s){return s[0]}))),o=Math.min.apply(Math,rr(n.map(function(s){return s[1]}))),i=Math.max.apply(Math,rr(n.map(function(s){return s[1]})));return[[a,o],[v,i]]}},{key:"getBoundingRegion",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return zr(this,t.z||0)}},{key:"getLocationAtPoint",value:function(t){var n=t.lngLat,a=t.pos;return this.getMapCenterByLngLatPosition({lngLat:n,pos:a})}}]),r}();function be(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(r,a).enumerable})),t.push.apply(t,n)}return t}function H(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?be(Object(t),!0).forEach(function(n){h(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):be(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}var Qr=512,nt=Math.PI/180;function Ar(r){var e=r.map,t=r.gl,n=r.deck;if(e.__deck)return e.__deck;var a=n?.props._customRender,v=n?.props.onLoad,o=Jr(H(H({},n?.props),{},{_customRender:function(){e.triggerRepaint(),a?.("")}})),i;return(!n||n.props.gl===t)&&(Object.assign(o,{gl:t,width:null,height:null,touchAction:"unset",viewState:ir(e)}),n!=null&&n.isInitialized?ze(n,e):o.onLoad=function(){v?.(),ze(i,e)}),n?(i=n,n.setProps(o),n.userData.isExternal=!0):(i=new X.Deck(o),e.on("remove",function(){Kr(e)})),i.userData.mapboxLayers=new Set,e.__deck=i,e.on("render",function(){i.isInitialized&&it(i,e)}),i}function ze(r,e){var t=function n(){r.isInitialized?ot(r,e):e.off("move",n)};e.on("move",t)}function Kr(r){var e;(e=r.__deck)===null||e===void 0||e.finalize(),r.__deck=null}function Jr(r){var e=H(H({},r),{},{parameters:H({depthMask:!0,depthTest:!0,blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthFunc:515,blendEquation:32774},r.parameters),views:r.views||[new X.MapView({id:"mapbox"})]});return e}function Ae(r,e){r.userData.mapboxLayers.add(e),re(r)}function Le(r,e){r.userData.mapboxLayers.delete(e),re(r)}function Te(r,e){re(r)}function Se(r,e,t){var n=r.userData,a=n.currentViewport,v=!1;a||(a=je(r,e,!0),r.userData.currentViewport=a,v=!0),r.isInitialized&&r._drawLayers("mapbox-repaint",{viewports:[a],layerFilter:function(i){var s=i.layer;return t.id===s.id},clearStack:v,clearCanvas:!1})}function ir(r){var e,t=r.getCenter(),n=t.lng,a=t.lat,v={longitude:(n+540)%360-180,latitude:a,zoom:r.getZoom(),bearing:r.getBearing(),pitch:r.getPitch(),padding:r.getPadding(),repeat:r.getRenderWorldCopies()};return(e=r.getTerrain)!==null&&e!==void 0&&e.call(r)&&at(r,v),v}function at(r,e){if(r.getFreeCameraOptions){var t=r.getFreeCameraOptions(),n=t.position;if(!n||n.z===void 0)return;var a=r.transform.height,v=e.longitude,o=e.latitude,i=e.pitch,s=n.x*Qr,l=(1-n.y)*Qr,c=n.z*Qr,f=D([v,o]),p=s-f[0],u=l-f[1],_=Math.sqrt(p*p+u*u),w=i*nt,P=1.5*a,m=w<.001?P*Math.cos(w)/c:P*Math.sin(w)/_;e.zoom=Math.log2(m);var O=P*Math.cos(w)/m,d=c-O;e.position=[0,0,d/Xr(o)]}else typeof r.transform.elevation=="number"&&(e.position=[0,0,r.transform.elevation])}function je(r,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;return new X.WebMercatorViewport(H(H({id:"mapbox",x:0,y:0,width:r.width,height:r.height},ir(e)),{},{nearZMultiplier:t?.02:.1}))}function it(r,e){var t=r.userData,n=t.mapboxLayers,a=t.isExternal;if(a){var v=Array.from(n,function(f){return f.id}),o=(0,X._flatten)(r.props.layers,Boolean),i=o.some(function(f){return f&&!v.includes(f.id)}),s=r.getViewports(),l=s.findIndex(function(f){return f.id==="mapbox"}),c=s.length>1||l<0;(i||c)&&(l>=0&&(s=s.slice(),s[l]=je(r,e,!1)),r._drawLayers("mapbox-repaint",{viewports:s,layerFilter:function(p){return(!r.props.layerFilter||r.props.layerFilter(p))&&(p.viewport.id!=="mapbox"||!v.includes(p.layer.id))},clearCanvas:!1}))}r.userData.currentViewport=null}function ot(r,e){r.setProps({viewState:ir(e)}),r.needsRedraw({clearRedrawFlags:!0})}function re(r){if(!r.userData.isExternal){var e=[];r.userData.mapboxLayers.forEach(function(t){var n=t.props.type,a=new n(t.props);e.push(a)}),r.setProps({layers:e})}}var Lr=function(){function r(e){if(B(this,r),h(this,"id",void 0),h(this,"type",void 0),h(this,"renderingMode",void 0),h(this,"map",void 0),h(this,"deck",void 0),h(this,"props",void 0),!e.id)throw new Error("Layer must have an unique id");this.id=e.id,this.type="custom",this.renderingMode=e.renderingMode||"3d",this.map=null,this.deck=null,this.props=e}return U(r,[{key:"onAdd",value:function(t,n){this.map=t,this.deck=Ar({map:t,gl:n,deck:this.props.deck}),Ae(this.deck,this)}},{key:"onRemove",value:function(){this.deck&&Le(this.deck,this)}},{key:"setProps",value:function(t){Object.assign(this.props,t,{id:this.id}),this.deck&&Te(this.deck,this)}},{key:"render",value:function(){Se(this.deck,this.map,this)}}]),r}();function ee(r,e){if(r==null)return{};var t={},n=Object.keys(r),a,v;for(v=0;v<n.length;v++)a=n[v],!(e.indexOf(a)>=0)&&(t[a]=r[a]);return t}function te(r,e){if(r==null)return{};var t=ee(r,e),n,a;if(Object.getOwnPropertySymbols){var v=Object.getOwnPropertySymbols(r);for(a=0;a<v.length;a++)n=v[a],!(e.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(r,n)&&(t[n]=r[n])}return t}var G=lr(K());var ae=lr(K());function Tr(r,e){var t=typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(!t){if(Array.isArray(r)||(t=st(r))||e&&r&&typeof r.length=="number"){t&&(r=t);var n=0,a=function(){};return{s:a,n:function(){return n>=r.length?{done:!0}:{done:!1,value:r[n++]}},e:function(l){throw l},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var v=!0,o=!1,i;return{s:function(){t=t.call(r)},n:function(){var l=t.next();return v=l.done,l},e:function(l){o=!0,i=l},f:function(){try{!v&&t.return!=null&&t.return()}finally{if(o)throw i}}}}function st(r,e){if(r){if(typeof r=="string")return Ie(r,e);var t=Object.prototype.toString.call(r).slice(8,-1);if(t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set")return Array.from(r);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Ie(r,e)}}function Ie(r,e){(e==null||e>r.length)&&(e=r.length);for(var t=0,n=new Array(e);t<e;t++)n[t]=r[t];return n}var ne="__UNDEFINED__";function pr(r,e,t,n){if(!(!r||!e||!r.style||!r.style._loaded)){var a=(0,ae._flatten)(n,Boolean);if(t!==n){var v=(0,ae._flatten)(t,Boolean),o=new Set(v.map(function(x){return x.id})),i=Tr(a),s;try{for(i.s();!(s=i.n()).done;){var l=s.value;o.delete(l.id)}}catch(x){i.e(x)}finally{i.f()}var c=Tr(o),f;try{for(c.s();!(f=c.n()).done;){var p=f.value;r.getLayer(p)&&r.removeLayer(p)}}catch(x){c.e(x)}finally{c.f()}}var u=Tr(a),_;try{for(u.s();!(_=u.n()).done;){var w=_.value,P=r.getLayer(w.id);P?P.implementation.setProps(w.props):r.addLayer(new Lr({id:w.id,deck:e}),w.props.beforeId)}}catch(x){u.e(x)}finally{u.f()}var m=r.style._order,O={},d=Tr(a),y;try{for(d.s();!(y=d.n()).done;){var g=y.value,M=g.props.beforeId;(!M||!m.includes(M))&&(M=ne),O[M]=O[M]||[],O[M].push(g.id)}}catch(x){d.e(x)}finally{d.f()}for(var b in O)for(var I=O[b],T=b===ne?m.length:m.indexOf(b),S=b===ne?void 0:b,z=I.length-1;z>=0;z--){var E=I[z],A=m.indexOf(E);A!==T-1&&(r.moveLayer(E,S),A>T&&T++),T--,S=E}}}var vt=["interleaved"];function ke(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(r,a).enumerable})),t.push.apply(t,n)}return t}function or(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?ke(Object(t),!0).forEach(function(n){h(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):ke(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}var De=function(){function r(e){var t=this;B(this,r),h(this,"_props",void 0),h(this,"_deck",void 0),h(this,"_map",void 0),h(this,"_container",void 0),h(this,"_interleaved",void 0),h(this,"_lastMouseDownPoint",void 0),h(this,"_handleStyleChange",function(){pr(t._map,t._deck,t._props.layers,t._props.layers)}),h(this,"_updateContainerSize",function(){if(t._map&&t._container){var o=t._map.getContainer(),i=o.clientWidth,s=o.clientHeight;Object.assign(t._container.style,{width:"".concat(i,"px"),height:"".concat(s,"px")})}}),h(this,"_updateViewState",function(){var o=t._deck;o&&(o.setProps({viewState:ir(t._map)}),o.isInitialized&&o.redraw())}),h(this,"_handleMouseEvent",function(o){var i=t._deck;if(!(!i||!i.isInitialized)){var s={type:o.type,offsetCenter:o.point,srcEvent:o},l=t._lastMouseDownPoint;switch(!o.point&&l&&(s.deltaX=o.originalEvent.clientX-l.clientX,s.deltaY=o.originalEvent.clientY-l.clientY,s.offsetCenter={x:l.x+s.deltaX,y:l.y+s.deltaY}),s.type){case"mousedown":i._onPointerDown(s),t._lastMouseDownPoint=or(or({},o.point),{},{clientX:o.originalEvent.clientX,clientY:o.originalEvent.clientY});break;case"dragstart":s.type="panstart",i._onEvent(s);break;case"drag":s.type="panmove",i._onEvent(s);break;case"dragend":s.type="panend",i._onEvent(s);break;case"click":s.tapCount=1,i._onEvent(s);break;case"dblclick":s.type="click",s.tapCount=2,i._onEvent(s);break;case"mousemove":s.type="pointermove",i._onPointerMove(s);break;case"mouseout":s.type="pointerleave",i._onPointerMove(s);break;default:return}}});var n=e.interleaved,a=n===void 0?!1:n,v=te(e,vt);this._interleaved=a,this._props=v}return U(r,[{key:"setProps",value:function(t){this._interleaved&&t.layers&&pr(this._map,this._deck,this._props.layers,t.layers),Object.assign(this._props,t),this._deck&&this._deck.setProps(this._interleaved?Jr(this._props):this._props)}},{key:"onAdd",value:function(t){return this._map=t,this._interleaved?this._onAddInterleaved(t):this._onAddOverlaid(t)}},{key:"_onAddOverlaid",value:function(t){var n=document.createElement("div");return Object.assign(n.style,{position:"absolute",left:0,top:0,pointerEvents:"none"}),this._container=n,this._deck=new G.Deck(or(or({},this._props),{},{parent:n,viewState:ir(t)})),t.on("resize",this._updateContainerSize),t.on("render",this._updateViewState),t.on("mousedown",this._handleMouseEvent),t.on("dragstart",this._handleMouseEvent),t.on("drag",this._handleMouseEvent),t.on("dragend",this._handleMouseEvent),t.on("mousemove",this._handleMouseEvent),t.on("mouseout",this._handleMouseEvent),t.on("click",this._handleMouseEvent),t.on("dblclick",this._handleMouseEvent),this._updateContainerSize(),n}},{key:"_onAddInterleaved",value:function(t){return this._deck=Ar({map:t,gl:t.painter.context.gl,deck:new G.Deck(or(or({},this._props),{},{gl:t.painter.context.gl}))}),t.on("styledata",this._handleStyleChange),pr(t,this._deck,[],this._props.layers),document.createElement("div")}},{key:"onRemove",value:function(){var t=this._map;t&&(this._interleaved?this._onRemoveInterleaved(t):this._onRemoveOverlaid(t)),this._deck=void 0,this._map=void 0,this._container=void 0}},{key:"_onRemoveOverlaid",value:function(t){var n;t.off("resize",this._updateContainerSize),t.off("render",this._updateViewState),t.off("mousedown",this._handleMouseEvent),t.off("dragstart",this._handleMouseEvent),t.off("drag",this._handleMouseEvent),t.off("dragend",this._handleMouseEvent),t.off("mousemove",this._handleMouseEvent),t.off("mouseout",this._handleMouseEvent),t.off("click",this._handleMouseEvent),t.off("dblclick",this._handleMouseEvent),(n=this._deck)===null||n===void 0||n.finalize()}},{key:"_onRemoveInterleaved",value:function(t){t.off("styledata",this._handleStyleChange),pr(t,this._deck,this._props.layers,[]),Kr(t)}},{key:"getDefaultPosition",value:function(){return"top-left"}},{key:"pickObject",value:function(t){return(0,G.assert)(this._deck),this._deck.pickObject(t)}},{key:"pickMultipleObjects",value:function(t){return(0,G.assert)(this._deck),this._deck.pickMultipleObjects(t)}},{key:"pickObjects",value:function(t){return(0,G.assert)(this._deck),this._deck.pickObjects(t)}},{key:"finalize",value:function(){this._map&&this._map.removeControl(this)}}]),r}();return Ue(dr);})();
      return __exports__;
      });
